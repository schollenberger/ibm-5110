0010 REM *** TSIO1-V1 2023/09/13 W. SCHOLLENBERGER ***
0015 REM *** TEST CHARACTER ENCODING OVER SIO      ***
0017 REM *** 8-BIT EBCDIC RECEIVE                  ***
0018 REM
0020 REM WRITEFILE FLS,'F'
0030 REM DIM A(200,7),A$64,B$255,C$255,C$18(8),D$255,G$128,H$16
0035 DIM A$64,B$255,C$255,D$255,H$16
0040 DIM X$2(256)
0050 REM D=1 *** DEBUG MODE WITHOUT SIOXFERS ***
0060 REM D=1
0070 REM IF D=1 GOTO 120
0080 REM OPEN FL8,'A08',OUT
0090 REM PRINT FL8,'R/9600,F/C,I/254,O/254,K/I,N/15,E/1E,L/00,B/1F'
0095 REM PRINT FL8,'R/9600,F/C,I/254,O/254,K/I,N/15,E/1E,L/00,B/1F'
0100 RE; PRINT FL8,'Y/D'
0110 REM CLOSE FL8
0120 I,J,K=0
0130 REM *** FILL HEXTABLE FOR EBCDIC ***
0140 STR(C$,1,15)=X'FEFDFCFBFAF9F8F7F6F5F4F3F2F1F0'
0150 STR(C$,16,16)=X'EFEEEDECEBEAE9E8E7E6E5E4E3E2E1E0'
0160 STR(C$,32,16)=X'DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1D0'
0170 STR(C$,48,16)=X'CFCECDCCCBCAC9C8C7C6C5C4C3C2C1C0'
0180 STR(C$,64,16)=X'BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0'
0190 STR(C$,80,16)=X'AFAEADACABAAA9A8A7A6A5A4A3A2A1A0'
0200 STR(C$,96,16)=X'9F9E9D9C9B9A99989796959493929190'
0210 STR(C$,112,16)=X'8F8E8D8C8B8A89888786858483828180'
0220 STR(C$,128,16)=X'7F7E7D7C7B7A79787776757473727170'
0230 STR(C$,144,16)=X'6F6E6D6C6B6A69686766656463626160'
0240 STR(C$,160,16)=X'5F5E5D5C5B5A59585756555453525150'
0250 STR(C$,176,16)=X'4F4E4D4C4B4A49484746454443424140'
0260 STR(C$,192,16)=X'3F3E3D3C3B3A39383736353433323130'
0270 STR(C$,208,16)=X'2F2E2D2C2B2A29282726252423222120'
0280 STR(C$,224,16)=X'1F1E1D1C1B1A19181716151413121110'
0290 STR(C$,240,16)=X'0F0E0D0C0B0A09080706050403020100'
0300 REM *** FILL HEXTABLE FOR ALC (5100) ***
0310 STR(D$,1,15)=X'C1C2C3C4C5C6C7C8C9D1D2D3D4D5D6'
0320 STR(D$,16,16)=X'D7D8D9E2E3E4E5E6E7E8E9F0F1F2F3F4'
0330 STR(D$,32,16)=X'F5F6F7F8F9614EB69FADBD6B4BB0ACAA'
0340 STR(D$,48,16)=X'8EB16DBABBB2AF7D90BFBC9D5C6FB38D'
0350 STR(D$,64,16)=X'808BABB49A8A9B7172A04C8C7EAE6EBE'
0360 STR(D$,80,16)=X'78B760B88F4D5D5E7ACDEDCFFDEAEBDE'
0370 STR(D$,96,16)=X'DBFBCCCEEEDADFCACBDCDDEFFE5F7F50'
0380 STR(D$,112,16)=X'7C7B5B6CEC757677C0E04F5AFA4AD06A'
0390 STR(D$,128,16)=X'3F414243444546474849515253545556'
0400 STR(D$,144,16)=X'575859626364656667686974799C9EA1'
0410 STR(D$,160,16)=X'B5B9E1FCFF8182838485868788899192'
0420 STR(D$,176,16)=X'9394959673979899A2A3A4A5A6A7A8A9'
0430 STR(D$,192,16)=X'00011202030405060708090A0B0C0E0F'
0440 STR(D$,208,16)=X'101113140D161718191A1B1C1D261F20'
0450 STR(D$,224,16)=X'2122231524252728292A2B2C2D2E2F70'
0460 STR(D$,240,16)=X'303132333435363738393A3B3C3D3E1E'
0470 N$=X'15'
0480 H$='FEDCBA9876543210'
0490 FOR I=0 TO 255
0500 K=INT(I/16)
0510 J=I-K*16
0520 STR(X$(I+1),1,1)=STR(H$,K+1,1)
0530 STR(X$(I+1),2,1)=STR(H$,J+1,1)
0540 NEXT I
0550 REM
0560 REM
0570 OPEN FL2,'A02',IN
0572 OPEN FL4,'A04',OUT
0574 REM WRITEFILE FLS,'N'
0580 PRINT "EBCDIC Table:"
0581 PAUSE
0581 PRINT STR(C$,1,15)
0581 FOR I=1 TO 15
0582 PRINT STR(C$,16*I+1,16)
0583 NEXT I
0586 PAUSE
0590 REM *** START RECEIVING ***
0600 PRINT 'GUEST COMPUTER IS WAITING'
0610 GET FL2,B$
0620 PRINT 'Received IN HEX:'
0630 PRINT B$
0640 GOSUB 2180
0650 PRINT 'RECEIVED IN CLEAR:'
0660 PRINT A$
0670 PAUSE
0680 GOTO 600
0690 REM
0700 REM
2180 REM *** CONVERT FROM HEX TO EBCDIC ***
2190 REM WRITEFILE FLS,'F'
2200 A$=''
2210 FOR I=0 TO LEN(B$)-1 STEP 2
2220 J=IDX(H$,STR(B$,I+1,1))-1
2230 K=IDX(H$,STR(B$,I+2,1))-1
2240 IF J*16+K=0 GOTO 2270
2250 STR(A$,INT(I/2)+1,1)=STR(C$,J*16+K,1)
2260 GOTO 2280
2270 STR(A$,INT(I/2)+1,1)=X'FF'
2280 NEXT I
2290 REM WRITEFILE FLS,'N'
2300 RETURN
2310 REM *** CONVERT EBCDIC TO HEX ***
2320 REM WRITEFILE FLS,'F'
2330 FOR I=0 TO L0
2340 PRINT FL4,X$(IDX(C$,STR(A$,I+1,1))+1);
2350 NEXT I
2360 REM WRITEFILE FLS,'N'
2370 RETURN
