0010 REM *** SIOXFER EC.2025/02/14 H.RUFFNER ***
0020 WRITEFILE FLS,'F'
0030 DIM A(200,7),A$64,B$255,C$255,C$18(8),D$255,G$128,H$16
0040 DIM L$255,P$255,T$18(3),X$2(256)
0050 REM D=1 *** DEBUG MODE WITHOUT SIOXFERS ***
0060 REM D=1
0070 IF D=1 GOTO 120
0080 OPEN FL8,'A08',OUT
0090 PRINT FL8,'R/9600,F/C,I/254,O/254,K/I,N/15,E/1E,L/00,B/1F'
0100 PRINT FL8,'Y/D'
0110 CLOSE FL8
0120 I,J,K=0
0130 B=8
0140 REM *** FILL HEXTABLE FOR EBCDIC ***
0150 STR(C$,1,15)=X'FEFDFCFBFAF9F8F7F6F5F4F3F2F1F0'
0160 STR(C$,16,16)=X'EFEEEDECEBEAE9E8E7E6E5E4E3E2E1E0'
0170 STR(C$,32,16)=X'DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1D0'
0180 STR(C$,48,16)=X'CFCECDCCCBCAC9C8C7C6C5C4C3C2C1C0'
0190 STR(C$,64,16)=X'BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0'
0200 STR(C$,80,16)=X'AFAEADACABAAA9A8A7A6A5A4A3A2A1A0'
0210 STR(C$,96,16)=X'9F9E9D9C9B9A99989796959493929190'
0220 STR(C$,112,16)=X'8F8E8D8C8B8A89888786858483828180'
0230 STR(C$,128,16)=X'7F7E7D7C7B7A79787776757473727170'
0240 STR(C$,144,16)=X'6F6E6D6C6B6A69686766656463626160'
0250 STR(C$,160,16)=X'5F5E5D5C5B5A59585756555453525150'
0260 STR(C$,176,16)=X'4F4E4D4C4B4A49484746454443424140'
0270 STR(C$,192,16)=X'3F3E3D3C3B3A39383736353433323130'
0280 STR(C$,208,16)=X'2F2E2D2C2B2A29282726252423222120'
0290 STR(C$,224,16)=X'1F1E1D1C1B1A19181716151413121110'
0300 STR(C$,240,16)=X'0F0E0D0C0B0A09080706050403020100'
0310 REM *** FILL HEXTABLE FOR ALC (5100) ***
0320 STR(D$,1,15)=X'C1C2C3C4C5C6C7C8C9D1D2D3D4D5D6'
0330 STR(D$,16,16)=X'D7D8D9E2E3E4E5E6E7E8E9F0F1F2F3F4'
0340 STR(D$,32,16)=X'F5F6F7F8F9614EB69FADBD6B4BB0ACAA'
0350 STR(D$,48,16)=X'8EB16DBABBB2AF7D90BFBC9D5C6FB38D'
0360 STR(D$,64,16)=X'808BABB49A8A9B7172A04C8C7EAE6EBE'
0370 STR(D$,80,16)=X'78B760B88F4D5D5E7ACDEDCFFDEAEBDE'
0380 STR(D$,96,16)=X'DBFBCCCEEEDADFCACBDCDDEFFE5F7F50'
0390 STR(D$,112,16)=X'7C7B5B6CEC757677C0E04F5AFA4AD06A'
0400 STR(D$,128,16)=X'3F414243444546474849515253545556'
0410 STR(D$,144,16)=X'575859626364656667686974799C9EA1'
0420 STR(D$,160,16)=X'B5B9E1FCFF8182838485868788899192'
0430 STR(D$,176,16)=X'9394959673979899A2A3A4A5A6A7A8A9'
0440 STR(D$,192,16)=X'00011202030405060708090A0B0C0E0F'
0450 STR(D$,208,16)=X'101113140D161718191A1B1C1D261F20'
0460 STR(D$,224,16)=X'2122231524252728292A2B2C2D2E2F70'
0470 STR(D$,240,16)=X'303132333435363738393A3B3C3D3E1E'
0480 N$=X'15'
0490 H$='FEDCBA9876543210'
0500 FOR I=0 TO 255
0510 K=INT(I/16)
0520 J=I-K*16
0530 STR(X$(I+1),1,1)=STR(H$,K+1,1)
0540 STR(X$(I+1),2,1)=STR(H$,J+1,1)
0550 NEXT I
0560 IF D=1 GOTO 2550
0570 OPEN FL2,'A02',IN
0580 OPEN FL4,'A04',OUT
0590 WRITEFILE FLS,'N'
0600 REM *** START TRANSFER ***
0610 PRINT 'GUEST COMPUTER IS WAITING'
0620 GET FL2,B$
0630 PRINT B$
0640 IF STR(B$,1,2)þ'10'|Bþ8 GOTO 660
0650 GOSUB 2210
0660 IF STR(A$,2,5)='BITS=' GOTO 740
0670 IF STR(A$,2,8)='FILETYP=' GOTO 880
0680 IF STR(A$,2,8)='DSTFILE=' GOTO 970
0690 IF STR(A$,2,8)='SRCFILE=' GOTO 1460
0700 IF STR(A$,2,8)='MESSAGE=' GOTO 2120
0710 IF STR(A$,2,4)='STOP' GOTO 2170
0720 PRINT A$
0730 GOTO 620
0740 REM *** EXTRACT BITS ***
0750 B=NUM(STR(A$,7,1))
0760 PRINT 'BITS=';B
0770 GOTO 620
0780 REM *** EXTRACT FILENAME ***
0790 E$,F$=''
0800 F=0
0810 A$=STR(A$,10)
0820 IF IDX('ED',STR(A$,1,1))=0 GOTO 850
0830 E$=STR(A$,1,3)
0840 A$=STR(A$,IDX(A$,' ')+1)
0850 F=NUM(STR(A$,1,IDX(A$,' ')))
0860 F$=STR(A$,IDX(A$,' ')+1)
0870 RETURN
0880 REM *** EXTRACT FILETYPE ***
0890 T$(1)=STR(A$,10,3)
0900 IF STR(T$(1),1,1)='T'|T$(1)='PRT' GOTO 930
0910 T$(2),T$(3)=''
0920 GOTO 950
0930 T$(2)=STR(A$,16,3)
0940 T$(3)=STR(A$,22,4)
0950 PRINT 'FILETYPE=';T$(1);'_C=';T$(2);'_L=';T$(3)
0960 GOTO 620
0970 PRINT ' *** PUT FILE TO 5110 ***'
0980 IF T$(1)='500' GOTO 1250
0990 GOSUB 780
1000 PRINT 'OUTPUT FILE='E$;' ';F;' ';F$
1010 IF T$(1)='T02' GOTO 1040
1020 IF T$(1)='T09' GOTO 1120
1030 IF T$(1)='DIG' GOTO 1720
1040 PRINT ' *** PUT T02-FILE TO 5110 ***'
1050 OPEN FL1,E$,F,F$,OUT
1060 GET FL2,B$
1070 IF B$='04' GOTO 1420
1080 GOSUB 2210
1090 PRINT A$
1100 PRINT FL1,A$;N$;
1110 GOTO 1060
1120 PRINT ' *** PUT T09-FILE TO 5110 ***'
1130 T3=NUM(T$(3))
1140 OPEN FILE FL1,E$,F,F$,OUT,RECL=T3,SEQ
1150 GET FL2,B$
1160 IF B$='04' GOTO 1420
1170 GOSUB 2210
1180 PRINT A$
1190 WRITEFILE FL1,A$
1200 GOTO 1150
1210 PRINT ' *** PUT DIG-FILE TO 5110 ***'
1220 PRINT 'PUT DIG-FILE CURRENTLY NOT SUPPORTED - EXECUTE'
1230 PAUSE
1240 GOTO 620
1250 PRINT ' *** PUT 500-FILE TO PRINTER ***'
1260 GET FL2,L$
1270 L0=0
1280 IF L$='04' GOTO 1420
1290 FOR I0=1 TO LEN(L$) STEP 30
1300 B$=STR(L$,I0,30)
1310 GOSUB 2210
1320 FOR L1=1 TO LEN(A$)
1330 L0=L0+1
1340 IF L0<NUM(T$(3)) GOTO 1370
1350 PRINT FLP
1360 L0=0
1370 PRINT FLP,STR(A$,L1,1);
1380 NEXT L1
1390 NEXT I0
1400 PRINT FLP
1410 GOTO 1260
1420 REM *** EOF ***
1430 CLOSE FL1
1440 PRINT 'FILETRANSFER ENDED'
1450 GOTO 600
1460 PRINT ' *** GET FILE FROM 5110 ***'
1470 GOSUB 780
1480 PRINT 'INPUT FILE='E$;' ';F;' ';F$
1490 IF T$(1)='T02' GOTO 1620
1500 IF T$(1)='T09' GOTO 1530
1510 IF T$(1)='DIG' GOTO 1720
1520 GOTO 620
1530 REM *** GET T09-FILE FROM 5110 ***'
1540 PRINT 'INPUT FILE='E$;' ';F;' ';F$
1550 OPEN FILE FL1,E$,F,F$,IN
1560 READFILE FL1,A$,EOF 2080
1570 PRINT A$
1580 L0=LEN(A$)-1
1590 GOSUB 2340
1600 PRINT FL4,'151E';
1610 GOTO 1560
1620 REM *** GET T02-FILE FROM 5110 ***'
1630 OPEN FL1,E$,F,F$,IN
1640 J0=0
1650 GET FL1,B$,EOF 2080
1660 A$=B$
1670 PRINT A$
1680 L0=LEN(A$)-1
1690 GOSUB 2410
1700 J0=J0+I
1710 GOTO 1650
1720 REM *** GET DIG-FILE FROM 5110 ***'
1730 T$(2)='EBC'
1740 T$(3)='000'
1750 OPEN FL1,E$,F,F$,IN
1760 GET FL1,D,U,H1,W1,G,H,W
1770 MAT GET FL1,C$,A
1780 A$=CHR(D)||','||CHR(U)||','||CHR(H1)||','||CHR(W1)
1790 A$=A$||','||CHR(G)||','||CHR(H)||','||CHR(W)
1800 L0=LEN(A$)-1
1810 GOSUB 2340
1820 PRINT A$
1830 PRINT FL4,'151E';
1840 FOR L=1 TO 8
1850 A$=C$(L)
1860 L0=LEN(A$)-1
1870 PRINT FL4,'7D';
1880 GOSUB 2340
1890 PRINT A$
1900 PRINT FL4,'7D151E';
1910 NEXT L
1920 FOR L=1 TO 200
1930 A$=CHR(A(L,1))||','||CHR(A(L,2))||','||CHR(A(L,3))||','
1940 L0=LEN(A$)-1
1950 GOSUB 2340
1960 PRINT A$;
1970 A$=CHR(A(L,4))||','||CHR(A(L,5))||','||CHR(A(L,6))
1980 L0=LEN(A$)-1
1990 GOSUB 2340
2000 PRINT A$;
2010 A$=','||CHR(A(L,7))
2020 L0=LEN(A$)-1
2030 GOSUB 2340
2040 PRINT A$
2050 PRINT FL4,'151E';
2060 NEXT L
2070 REM *** EOF ***
2080 CLOSE FL1
2090 PRINT FL4,'041E1F'
2100 PRINT 'FILETRANSFER ENDED'
2110 GOTO 600
2120 REM *** MESSAGE ***
2130 PRINT A$
2140 WRITEFILE FLS,'A'
2150 PAUSE
2160 GOTO 600
2170 REM *** STOP ***
2180 CLOSE FL2
2190 CLOSE FL4
2200 STOP
2210 REM *** CONVERT FROM HEX TO EBCDIC ***
2220 WRITEFILE FLS,'F'
2230 A$=''
2240 FOR I=0 TO LEN(B$)-1 STEP 2
2250 J=IDX(H$,STR(B$,I+1,1))-1
2260 K=IDX(H$,STR(B$,I+2,1))-1
2270 IF J*16+K=0 GOTO 2300
2280 STR(A$,INT(I/2)+1,1)=STR(C$,J*16+K,1)
2290 GOTO 2310
2300 STR(A$,INT(I/2)+1,1)=X'FF'
2310 NEXT I
2320 WRITEFILE FLS,'N'
2330 RETURN
2340 REM *** CONVERT EBCDIC TO HEX ***
2350 WRITEFILE FLS,'F'
2360 FOR I=0 TO L0
2370 PRINT FL4,X$(IDX(C$,STR(A$,I+1,1))+1);
2380 NEXT I
2390 WRITEFILE FLS,'N'
2400 RETURN
2410 REM *** CONVERT EBC,ALC,HEX TO HEX ***
2420 WRITEFILE FLS,'F'
2430 IF T$(2)='EBC' GOTO 2460
2440 IF T$(2)='ALC' GOTO 2500
2450 IF T$(2)='HEX' GOTO 2530
2460 FOR I=0 TO L0
2470 PRINT FL4,X$(IDX(C$,STR(A$,I+1,1))+1);
2480 NEXT I
2490 GOTO 2530
2500 FOR I=0 TO L0
2510 PRINT FL4,X$(255-IDX(D$,STR(A$,I+1,1))+1);
2520 NEXT I
2530 WRITEFILE FLS,'N'
2540 RETURN
2550 REM *** DEBUG PART ***
2560 PAUSE
2570 STOP
