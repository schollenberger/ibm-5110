0010 REM *** SIOXFER EC.2007/10/22 H.RUFFNER ***
0020 WRITEFILE FLS,'F'
0030 OPEN FL8,'A08',OUT
0040 PRINT FL8,'R/9600,F/C,I/254,O/254,K/I,N/15,E/1E,L/00,B/1F'
0050 PRINT FL8,'Y/D'
0060 CLOSE FL8
0070 I,J,K=0
0080 T$='TXT'
0090 DIM A(200,7),A$64,B$255,C$255,C$18(8),D$128,H$16,X$2(256)
0100 STR(C$,1,15)=X'FEFDFCFBFAF9F8F7F6F5F4F3F2F1F0'
0110 STR(C$,16,16)=X'EFEEEDECEBEAE9E8E7E6E5E4E3E2E1E0'
0120 STR(C$,32,16)=X'DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1D0'
0130 STR(C$,48,16)=X'CFCECDCCCBCAC9C8C7C6C5C4C3C2C1C0'
0140 STR(C$,64,16)=X'BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0'
0150 STR(C$,80,16)=X'AFAEADACABAAA9A8A7A6A5A4A3A2A1A0'
0160 STR(C$,96,16)=X'9F9E9D9C9B9A99989796959493929190'
0170 STR(C$,112,16)=X'8F8E8D8C8B8A89888786858483828180'
0180 STR(C$,128,16)=X'7F7E7D7C7B7A79787776757473727170'
0190 STR(C$,144,16)=X'6F6E6D6C6B6A69686766656463626160'
0200 STR(C$,160,16)=X'5F5E5D5C5B5A59585756555453525150'
0210 STR(C$,176,16)=X'4F4E4D4C4B4A49484746454443424140'
0220 STR(C$,192,16)=X'3F3E3D3C3B3A39383736353433323130'
0230 STR(C$,208,16)=X'2F2E2D2C2B2A29282726252423222120'
0240 STR(C$,224,16)=X'1F1E1D1C1B1A19181716151413121110'
0250 STR(C$,240,16)=X'0F0E0D0C0B0A09080706050403020100'
0260 N$=X'15'
0270 H$='FEDCBA9876543210'
0280 FOR I=0 TO 255
0290 K=INT(I/16)
0300 J=I-K*16
0310 STR(X$(I+1),1,1)=STR(H$,K+1,1)
0320 STR(X$(I+1),2,1)=STR(H$,J+1,1)
0330 NEXT I
0340 OPEN FL2,'A02',IN
0350 OPEN FL4,'A04',OUT
0360 WRITEFILE FLS,'N'
0370 REM *** START TRANSFER ***
0380 PRINT 'GUEST COMPUTER IS WAITING'
0390 PRINT 'FILETYPE = ';T$
0400 GET FL2,B$
0410 IF STR(B$,1,2)Ø'10' GOTO 450
0420 IF STR(B$,1,18)='10C4E2E3C6C9D3C57E' GOTO 480
0430 IF STR(B$,1,18)='10E2D9C3C6C9D3C57E' GOTO 620
0440 IF STR(B$,1,8)='10C6E37E' GOTO 1170
0450 GOSUB 1220
0460 PRINT A$
0470 GOTO 370
0480 PRINT ' *** PUT TXT-FILE TO 5110 ***'
0490 GOSUB 1220
0500 GOSUB 1420
0510 PRINT 'OUTPUT FILE='E$;' ';F;' ';F$
0520 OPEN FL1,E$,F,F$,OUT
0530 GET FL2,B$
0540 IF B$='1A' GOTO 590
0550 GOSUB 1220
0560 PRINT A$
0570 PRINT FL1,A$;N$;
0580 GOTO 530
0590 PRINT 'FILETRANSFER ENDED'
0600 CLOSE FL1
0610 GOTO 370
0620 PRINT ' *** GET FILE FROM 5110 ***'
0630 IF T$='DIG' GOTO 800
0640 REM *** GET TXT-FILE FROM 5110 ***'
0650 GOSUB 1220
0660 GOSUB 1420
0670 PRINT 'INPUT FILE='E$;' ';F;' ';F$
0680 OPEN FILE FL1,E$,F,F$,IN
0690 READFILE FL1,A$,EOF 760
0700 PRINT A$
0710 FOR I=1 TO 100
0720 NEXT I
0730 GOSUB 1350
0740 PRINT FL4,'151E';
0750 GOTO 690
0760 PRINT FL4,'1A151E1F'
0770 PRINT 'FILETRANSFER ENDED'
0780 CLOSE FL1
0790 GOTO 370
0800 REM *** GET DIG-FILE FROM 5110 ***'
0810 GOSUB 1220
0820 GOSUB 1420
0830 PRINT 'INPUT FILE='E$;' ';F;' ';F$
0840 OPEN FL1,E$,F,F$,IN
0850 GET FL1,D,U,H1,W1,G,H,W
0860 MAT GET FL1,C$,A
0870 CLOSE FL1
0880 A$=CHR(D)ÝÝ','ÝÝCHR(U)ÝÝ','ÝÝCHR(H1)ÝÝ','ÝÝCHR(W1)
0890 GOSUB 1350
0900 PRINT A$;
0910 A$=','ÝÝCHR(G)ÝÝ','ÝÝCHR(H)ÝÝ','ÝÝCHR(W)
0920 GOSUB 1350
0930 PRINT A$
0940 PRINT FL4,'151E';
0950 FOR L=1 TO 8
0960 A$=C$(L)
0970 PRINT FL4,'7D';
0980 GOSUB 1350
0990 PRINT A$
1000 PRINT FL4,'7D151E';
1010 NEXT L
1020 FOR L=1 TO 200
1030 A$=CHR(A(L,1))ÝÝ','ÝÝCHR(A(L,2))ÝÝ','ÝÝCHR(A(L,3))ÝÝ','
1040 GOSUB 1350
1050 PRINT A$;
1060 A$=CHR(A(L,4))ÝÝ','ÝÝCHR(A(L,5))ÝÝ','ÝÝCHR(A(L,6))
1070 GOSUB 1350
1080 PRINT A$;
1090 A$=','ÝÝCHR(A(L,7))
1100 GOSUB 1350
1110 PRINT A$
1120 PRINT FL4,'151E';
1130 NEXT L
1140 PRINT FL4,'1A151E1F'
1150 PRINT 'FILETRANSFER ENDED'
1160 GOTO 370
1170 PRINT ' *** MESSAGE *** '
1180 GOSUB 1220
1190 PRINT STR(A$,2)
1200 T$=STR(A$,5,3)
1210 GOTO 370
1220 REM *** CONVERT FROM HEX ***
1230 WRITEFILE FLS,'F'
1240 A$=''
1250 FOR I=0 TO LEN(B$)-1 STEP 2
1260 J=IDX(H$,STR(B$,I+1,1))-1
1270 K=IDX(H$,STR(B$,I+2,1))-1
1280 IF J*16+K=0 GOTO 1310
1290 STR(A$,INT(I/2)+1,1)=STR(C$,J*16+K,1)
1300 GOTO 1320
1310 STR(A$,INT(I/2)+1,1)=X'FF'
1320 NEXT I
1330 WRITEFILE FLS,'N'
1340 RETURN
1350 REM *** CONVERT TO HEX ***
1360 WRITEFILE FLS,'F'
1370 FOR I=0 TO LEN(A$)-1
1380 PRINT FL4,X$(IDX(C$,STR(A$,I+1,1))+1);
1390 NEXT I
1400 WRITEFILE FLS,'N'
1410 RETURN
1420 REM *** EXTRACT FILENAME ***
1430 E$,F$=''
1440 F=0
1450 A$=STR(A$,10)
1460 IF IDX('ED',STR(A$,1,1))=0 GOTO 1490
1470 E$=STR(A$,1,3)
1480 A$=STR(A$,IDX(A$,' ')+1)
1490 F=NUM(STR(A$,1,IDX(A$,' ')))
1500 F$=STR(A$,IDX(A$,' ')+1)
1510 RETURN
