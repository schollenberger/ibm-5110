0010 REM *** SIOXFER EC.2023/07/18 H.RUFFNER ***
0020 WRITEFILE FLS,'F'
0030 DIM A(200,7),A$64,B$255,C$255,C$18(8),D$255,G$64,H$16
0040 DIM T$18(3),X$2(256)
0050 REM D=1 *** DEBUG MODE WITHOUT SIOXFERS ***
0060 REM D=1
0070 IF D=1 GOTO 120
0080 OPEN FL8,'A08',OUT
0090 PRINT FL8,'R/9600,F/C,I/254,O/254,K/I,N/15,E/1E,L/00,B/1F'
0100 PRINT FL8,'Y/D'
0110 CLOSE FL8
0120 I,J,K=0
0130 REM *** FILL HEXTABLE FOR EBCDIC ***
0140 STR(C$,1,15)=X'FEFDFCFBFAF9F8F7F6F5F4F3F2F1F0'
0150 STR(C$,16,16)=X'EFEEEDECEBEAE9E8E7E6E5E4E3E2E1E0'
0160 STR(C$,32,16)=X'DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1D0'
0170 STR(C$,48,16)=X'CFCECDCCCBCAC9C8C7C6C5C4C3C2C1C0'
0180 STR(C$,64,16)=X'BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0'
0190 STR(C$,80,16)=X'AFAEADACABAAA9A8A7A6A5A4A3A2A1A0'
0200 STR(C$,96,16)=X'9F9E9D9C9B9A99989796959493929190'
0210 STR(C$,112,16)=X'8F8E8D8C8B8A89888786858483828180'
0220 STR(C$,128,16)=X'7F7E7D7C7B7A79787776757473727170'
0230 STR(C$,144,16)=X'6F6E6D6C6B6A69686766656463626160'
0240 STR(C$,160,16)=X'5F5E5D5C5B5A59585756555453525150'
0250 STR(C$,176,16)=X'4F4E4D4C4B4A49484746454443424140'
0260 STR(C$,192,16)=X'3F3E3D3C3B3A39383736353433323130'
0270 STR(C$,208,16)=X'2F2E2D2C2B2A29282726252423222120'
0280 STR(C$,224,16)=X'1F1E1D1C1B1A19181716151413121110'
0290 STR(C$,240,16)=X'0F0E0D0C0B0A09080706050403020100'
0300 REM *** FILL HEXTABLE FOR ALC (5100) ***
0310 STR(D$,1,15)=X'C1C2C3C4C5C6C7C8C9D1D2D3D4D5D6'
0320 STR(D$,16,16)=X'D7D8D9E2E3E4E5E6E7E8E9F0F1F2F3F4'
0330 STR(D$,32,16)=X'F5F6F7F8F9614EB69FADBD6B4BB0ACAA'
0340 STR(D$,48,16)=X'8EB16DBABBB2AF7D90BFBC9D5C6FB38D'
0350 STR(D$,64,16)=X'808BABB49A8A9B7172A04C8C7EAE6EBE'
0360 STR(D$,80,16)=X'78B760B88F4D5D5E7ACDEDCFFDEAEBDE'
0370 STR(D$,96,16)=X'DBFBCCCEEEDADFCACBDCDDEFFE5F7F50'
0380 STR(D$,112,16)=X'7C7B5B6CEC757677C0E04F5AFA4AD06A'
0390 STR(D$,128,16)=X'3F414243444546474849515253545556'
0400 STR(D$,144,16)=X'575859626364656667686974799C9EA1'
0410 STR(D$,160,16)=X'B5B9E1FCFF8182838485868788899192'
0420 STR(D$,176,16)=X'9394959673979899A2A3A4A5A6A7A8A9'
0430 STR(D$,192,16)=X'00011202030405060708090A0B0C0E0F'
0440 STR(D$,208,16)=X'101113140D161718191A1B1C1D261F20'
0450 STR(D$,224,16)=X'2122231524252728292A2B2C2D2E2F70'
0460 STR(D$,240,16)=X'303132333435363738393A3B3C3D3E1E'
0470 N$=X'15'
0480 H$='FEDCBA9876543210'
0490 FOR I=0 TO 255
0500 K=INT(I/16)
0510 J=I-K*16
0520 STR(X$(I+1),1,1)=STR(H$,K+1,1)
0530 STR(X$(I+1),2,1)=STR(H$,J+1,1)
0540 NEXT I
0550 IF D=1 GOTO 2440
0560 OPEN FL2,'A02',IN
0570 OPEN FL4,'A04',OUT
0580 WRITEFILE FLS,'N'
0590 REM *** START TRANSFER ***
0600 PRINT 'GUEST COMPUTER IS WAITING'
0610 GET FL2,B$
0620 IF STR(B$,1,2)þ'10' GOTO 680
0630 IF STR(B$,1,18)='10C6C9D3C5E3E8D77E' GOTO 810
0640 IF STR(B$,1,18)='10C4E2E3C6C9D3C57E' GOTO 910
0650 IF STR(B$,1,18)='10E2D9C3C6C9D3C57E' GOTO 1330
0660 IF STR(B$,1,18)='10D4C5E2E2C1C7C57E' GOTO 2000
0670 IF STR(B$,1,18)='10E2E3D6D7' GOTO 2060
0680 GOSUB 2100
0690 PRINT A$
0700 GOTO 590
0710 REM *** EXTRACT FILENAME ***
0720 E$,F$=''
0730 F=0
0740 A$=STR(A$,10)
0750 IF IDX('ED',STR(A$,1,1))=0 GOTO 780
0760 E$=STR(A$,1,3)
0770 A$=STR(A$,IDX(A$,' ')+1)
0780 F=NUM(STR(A$,1,IDX(A$,' ')))
0790 F$=STR(A$,IDX(A$,' ')+1)
0800 RETURN
0810 REM *** EXTRACT FILETYPE ***
0820 GOSUB 2100
0830 T$(1)=STR(A$,10,3)
0840 IF STR(T$(1),1,1)='T' GOTO 870
0850 T$(2),T$(3)=''
0860 GOTO 890
0870 T$(2)=STR(A$,16,3)
0880 T$(3)=STR(A$,22,4)
0890 PRINT 'FILETYPE=';T$(1);'_C=';T$(2);'_L=';T$(3)
0900 GOTO 590
0910 PRINT ' *** PUT FILE TO 5110 ***'
0920 GOSUB 2100
0930 GOSUB 710
0940 PRINT 'OUTPUT FILE='E$;' ';F;' ';F$
0950 IF T$(1)='T02' GOTO 990
0960 IF T$(1)='T09' GOTO 1070
0970 IF T$(1)='DIG' GOTO 1600
0980 IF T$(1)='500' GOTO 1200
0990 PRINT ' *** PUT T02-FILE TO 5110 ***'
1000 OPEN FL1,E$,F,F$,OUT
1010 GET FL2,B$
1020 IF B$='041E1F' GOTO 1290
1030 GOSUB 2100
1040 PRINT A$
1050 PRINT FL1,A$;N$;
1060 GOTO 1010
1070 PRINT ' *** PUT T09-FILE TO 5110 ***'
1080 T3=NUM(T$(3))
1090 OPEN FILE FL1,E$,F,F$,OUT,RECL=T3,SEQ
1100 GET FL2,B$
1110 IF B$='041E1F' GOTO 1290
1120 GOSUB 2100
1130 PRINT A$
1140 WRITEFILE FL1,A$
1150 GOTO 1100
1160 PRINT ' *** PUT DIG-FILE TO 5110 ***'
1170 PRINT 'PUT DIG-FILE CURRENTLY NOT SUPPORTED - EXECUTE'
1180 PAUSE
1190 GOTO 590
1200 PRINT ' *** PUT 500-FILE TO PRINTER ***'
1210 GET FL2,B$
1220 GOSUB 2100
1230 IF LEN(A$)þNUM(T$(3)) GOTO 1270
1240 B$=A$
1250 A$=STR(B$,1,NUM(T$(3)))
1260 GOTO 1230
1270 PRINT FLP,A$
1280 GOTO 1210
1290 REM *** EOF ***
1300 PRINT 'FILETRANSFER ENDED'
1310 CLOSE FL1
1320 GOTO 590
1330 PRINT ' *** GET FILE FROM 5110 ***'
1340 GOSUB 2100
1350 GOSUB 710
1360 PRINT 'INPUT FILE='E$;' ';F;' ';F$
1370 IF T$(1)='T02' GOTO 1500
1380 IF T$(1)='T09' GOTO 1410
1390 IF T$(1)='DIG' GOTO 1600
1400 GOTO 590
1410 REM *** GET T09-FILE FROM 5110 ***'
1420 PRINT 'INPUT FILE='E$;' ';F;' ';F$
1430 OPEN FILE FL1,E$,F,F$,IN
1440 READFILE FL1,A$,EOF 1960
1450 PRINT A$
1460 L0=LEN(A$)-1
1470 GOSUB 2230
1480 PRINT FL4,'151E';
1490 GOTO 1440
1500 REM *** GET T02-FILE FROM 5110 ***'
1510 OPEN FL1,E$,F,F$,IN
1520 J0=0
1530 GET FL1,B$,EOF 1960
1540 A$=B$
1550 PRINT A$
1560 L0=LEN(A$)-1
1570 GOSUB 2300
1580 J0=J0+I
1590 GOTO 1530
1600 REM *** GET DIG-FILE FROM 5110 ***'
1610 T$(2)='EBC'
1620 T$(3)='000'
1630 OPEN FL1,E$,F,F$,IN
1640 GET FL1,D,U,H1,W1,G,H,W
1650 MAT GET FL1,C$,A
1660 A$=CHR(D)||','||CHR(U)||','||CHR(H1)||','||CHR(W1)
1670 A$=A$||','||CHR(G)||','||CHR(H)||','||CHR(W)
1680 L0=LEN(A$)-1
1690 GOSUB 2230
1700 PRINT A$
1710 PRINT FL4,'151E';
1720 FOR L=1 TO 8
1730 A$=C$(L)
1740 L0=LEN(A$)-1
1750 PRINT FL4,'7D';
1760 GOSUB 2230
1770 PRINT A$
1780 PRINT FL4,'7D151E';
1790 NEXT L
1800 FOR L=1 TO 200
1810 A$=CHR(A(L,1))||','||CHR(A(L,2))||','||CHR(A(L,3))||','
1820 L0=LEN(A$)-1
1830 GOSUB 2230
1840 PRINT A$;
1850 A$=CHR(A(L,4))||','||CHR(A(L,5))||','||CHR(A(L,6))
1860 L0=LEN(A$)-1
1870 GOSUB 2230
1880 PRINT A$;
1890 A$=','||CHR(A(L,7))
1900 L0=LEN(A$)-1
1910 GOSUB 2230
1920 PRINT A$
1930 PRINT FL4,'151E';
1940 NEXT L
1950 REM *** EOF ***
1960 CLOSE FL1
1970 PRINT FL4,'041E1F'
1980 PRINT 'FILETRANSFER ENDED'
1990 GOTO 590
2000 REM *** MESSAGE ***
2010 GOSUB 2100
2020 PRINT A$
2030 WRITEFILE FLS,'A'
2040 PAUSE
2050 GOTO 590
2060 REM *** STOP ***
2070 CLOSE FL2
2080 CLOSE FL4
2090 STOP
2100 REM *** CONVERT FROM HEX TO EBCDIC ***
2110 WRITEFILE FLS,'F'
2120 A$=''
2130 FOR I=0 TO LEN(B$)-1 STEP 2
2140 J=IDX(H$,STR(B$,I+1,1))-1
2150 K=IDX(H$,STR(B$,I+2,1))-1
2160 IF J*16+K=0 GOTO 2190
2170 STR(A$,INT(I/2)+1,1)=STR(C$,J*16+K,1)
2180 GOTO 2200
2190 STR(A$,INT(I/2)+1,1)=X'FF'
2200 NEXT I
2210 WRITEFILE FLS,'N'
2220 RETURN
2230 REM *** CONVERT EBCDIC TO HEX ***
2240 WRITEFILE FLS,'F'
2250 FOR I=0 TO L0
2260 PRINT FL4,X$(IDX(C$,STR(A$,I+1,1))+1);
2270 NEXT I
2280 WRITEFILE FLS,'N'
2290 RETURN
2300 REM *** CONVERT EBC,ALC,HEX TO HEX ***
