0010 REM *** SIOXFER EC.2023/08/01 H.RUFFNER ***
0020 WRITEFILE FLS,'F'
0030 DIM A(200,7),A$64,B$255,C$255,C$18(8),D$255,G$128,H$16
0040 DIM L$255,P$255,T$18(3),X$2(256)
0050 REM D=1 *** DEBUG MODE WITHOUT SIOXFERS ***
0060 REM D=1
0070 IF D=1 GOTO 120
0080 OPEN FL8,'A08',OUT
0090 PRINT FL8,'R/9600,F/C,I/254,O/254,K/I,N/15,E/1E,L/00,B/1F'
0100 PRINT FL8,'Y/D'
0110 CLOSE FL8
0120 I,J,K=0
0130 REM *** FILL HEXTABLE FOR EBCDIC ***
0140 STR(C$,1,15)=X'FEFDFCFBFAF9F8F7F6F5F4F3F2F1F0'
0150 STR(C$,16,16)=X'EFEEEDECEBEAE9E8E7E6E5E4E3E2E1E0'
0160 STR(C$,32,16)=X'DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1D0'
0170 STR(C$,48,16)=X'CFCECDCCCBCAC9C8C7C6C5C4C3C2C1C0'
0180 STR(C$,64,16)=X'BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0'
0190 STR(C$,80,16)=X'AFAEADACABAAA9A8A7A6A5A4A3A2A1A0'
0200 STR(C$,96,16)=X'9F9E9D9C9B9A99989796959493929190'
0210 STR(C$,112,16)=X'8F8E8D8C8B8A89888786858483828180'
0220 STR(C$,128,16)=X'7F7E7D7C7B7A79787776757473727170'
0230 STR(C$,144,16)=X'6F6E6D6C6B6A69686766656463626160'
0240 STR(C$,160,16)=X'5F5E5D5C5B5A59585756555453525150'
0250 STR(C$,176,16)=X'4F4E4D4C4B4A49484746454443424140'
0260 STR(C$,192,16)=X'3F3E3D3C3B3A39383736353433323130'
0270 STR(C$,208,16)=X'2F2E2D2C2B2A29282726252423222120'
0280 STR(C$,224,16)=X'1F1E1D1C1B1A19181716151413121110'
0290 STR(C$,240,16)=X'0F0E0D0C0B0A09080706050403020100'
0300 REM *** FILL HEXTABLE FOR ALC (5100) ***
0310 STR(D$,1,15)=X'C1C2C3C4C5C6C7C8C9D1D2D3D4D5D6'
0320 STR(D$,16,16)=X'D7D8D9E2E3E4E5E6E7E8E9F0F1F2F3F4'
0330 STR(D$,32,16)=X'F5F6F7F8F9614EB69FADBD6B4BB0ACAA'
0340 STR(D$,48,16)=X'8EB16DBABBB2AF7D90BFBC9D5C6FB38D'
0350 STR(D$,64,16)=X'808BABB49A8A9B7172A04C8C7EAE6EBE'
0360 STR(D$,80,16)=X'78B760B88F4D5D5E7ACDEDCFFDEAEBDE'
0370 STR(D$,96,16)=X'DBFBCCCEEEDADFCACBDCDDEFFE5F7F50'
0380 STR(D$,112,16)=X'7C7B5B6CEC757677C0E04F5AFA4AD06A'
0390 STR(D$,128,16)=X'3F414243444546474849515253545556'
0400 STR(D$,144,16)=X'575859626364656667686974799C9EA1'
0410 STR(D$,160,16)=X'B5B9E1FCFF8182838485868788899192'
0420 STR(D$,176,16)=X'9394959673979899A2A3A4A5A6A7A8A9'
0430 STR(D$,192,16)=X'00011202030405060708090A0B0C0E0F'
0440 STR(D$,208,16)=X'101113140D161718191A1B1C1D261F20'
0450 STR(D$,224,16)=X'2122231524252728292A2B2C2D2E2F70'
0460 STR(D$,240,16)=X'303132333435363738393A3B3C3D3E1E'
0470 N$=X'15'
0480 H$='FEDCBA9876543210'
0490 FOR I=0 TO 255
0500 K=INT(I/16)
0510 J=I-K*16
0520 STR(X$(I+1),1,1)=STR(H$,K+1,1)
0530 STR(X$(I+1),2,1)=STR(H$,J+1,1)
0540 NEXT I
0550 IF D=1 GOTO 2520
0560 OPEN FL2,'A02',IN
0570 OPEN FL4,'A04',OUT
0580 WRITEFILE FLS,'N'
0590 REM *** START TRANSFER ***
0600 PRINT 'GUEST COMPUTER IS WAITING'
0610 GET FL2,B$
0620 IF STR(B$,1,2)Ø'10' GOTO 680
0630 IF STR(B$,1,18)='10C6C9D3C5E3E8D77E' GOTO 810
0640 IF STR(B$,1,18)='10C4E2E3C6C9D3C57E' GOTO 910
0650 IF STR(B$,1,18)='10E2D9C3C6C9D3C57E' GOTO 1410
0660 IF STR(B$,1,18)='10D4C5E2E2C1C7C57E' GOTO 2080
0670 IF STR(B$,1,18)='10E2E3D6D7' GOTO 2140
0680 GOSUB 2180
0690 PRINT A$
0700 GOTO 590
0710 REM *** EXTRACT FILENAME ***
0720 E$,F$=''
0730 F=0
0740 A$=STR(A$,10)
0750 IF IDX('ED',STR(A$,1,1))=0 GOTO 780
0760 E$=STR(A$,1,3)
0770 A$=STR(A$,IDX(A$,' ')+1)
0780 F=NUM(STR(A$,1,IDX(A$,' ')))
0790 F$=STR(A$,IDX(A$,' ')+1)
0800 RETURN
0810 REM *** EXTRACT FILETYPE ***
0820 GOSUB 2180
0830 T$(1)=STR(A$,10,3)
0840 IF STR(T$(1),1,1)='T'|T$(1)='PRT' GOTO 870
0850 T$(2),T$(3)=''
0860 GOTO 890
0870 T$(2)=STR(A$,16,3)
0880 T$(3)=STR(A$,22,4)
0890 PRINT 'FILETYPE=';T$(1);'_C=';T$(2);'_L=';T$(3)
0900 GOTO 590
0910 PRINT ' *** PUT FILE TO 5110 ***'
0920 GOSUB 2180
0930 IF T$(1)='500' GOTO 1200
0940 GOSUB 710
0950 PRINT 'OUTPUT FILE='E$;' ';F;' ';F$
0960 IF T$(1)='T02' GOTO 990
0970 IF T$(1)='T09' GOTO 1070
0980 IF T$(1)='DIG' GOTO 1680
0990 PRINT ' *** PUT T02-FILE TO 5110 ***'
1000 OPEN FL1,E$,F,F$,OUT
1010 GET FL2,B$
1020 IF B$='04' GOTO 1370
1030 GOSUB 2180
1040 PRINT A$
1050 PRINT FL1,A$;N$;
1060 GOTO 1010
1070 PRINT ' *** PUT T09-FILE TO 5110 ***'
1080 T3=NUM(T$(3))
1090 OPEN FILE FL1,E$,F,F$,OUT,RECL=T3,SEQ
1100 GET FL2,B$
1110 IF B$='04' GOTO 1370
1120 GOSUB 2180
1130 PRINT A$
1140 WRITEFILE FL1,A$
1150 GOTO 1100
1160 PRINT ' *** PUT DIG-FILE TO 5110 ***'
1170 PRINT 'PUT DIG-FILE CURRENTLY NOT SUPPORTED - EXECUTE'
1180 PAUSE
1190 GOTO 590
1200 PRINT ' *** PUT 500-FILE TO PRINTER ***'
1210 GET FL2,L$
1220 L0=0
1230 IF L$='04' GOTO 1370
1240 FOR I0=1 TO LEN(L$) STEP 30
1250 B$=STR(L$,I0,30)
1260 GOSUB 2180
1270 FOR L1=1 TO LEN(A$)
1280 L0=L0+1
1290 IF L0<NUM(T$(3)) GOTO 1320
1300 PRINT FLP
1310 L0=0
1320 PRINT FLP,STR(A$,L1,1);
1330 NEXT L1
1340 NEXT I0
1350 PRINT FLP
1360 GOTO 1210
1370 REM *** EOF ***
1380 CLOSE FL1
1390 PRINT 'FILETRANSFER ENDED'
1400 GOTO 590
1410 PRINT ' *** GET FILE FROM 5110 ***'
1420 GOSUB 2180
1430 GOSUB 710
1440 PRINT 'INPUT FILE='E$;' ';F;' ';F$
1450 IF T$(1)='T02' GOTO 1580
1460 IF T$(1)='T09' GOTO 1490
1470 IF T$(1)='DIG' GOTO 1680
1480 GOTO 590
1490 REM *** GET T09-FILE FROM 5110 ***'
1500 PRINT 'INPUT FILE='E$;' ';F;' ';F$
1510 OPEN FILE FL1,E$,F,F$,IN
1520 READFILE FL1,A$,EOF 2040
1530 PRINT A$
1540 L0=LEN(A$)-1
1550 GOSUB 2310
1560 PRINT FL4,'151E';
1570 GOTO 1520
1580 REM *** GET T02-FILE FROM 5110 ***'
1590 OPEN FL1,E$,F,F$,IN
1600 J0=0
1610 GET FL1,B$,EOF 2040
1620 A$=B$
1630 PRINT A$
1640 L0=LEN(A$)-1
1650 GOSUB 2380
1660 J0=J0+I
1670 GOTO 1610
1680 REM *** GET DIG-FILE FROM 5110 ***'
1690 T$(2)='EBC'
1700 T$(3)='000'
1710 OPEN FL1,E$,F,F$,IN
1720 GET FL1,D,U,H1,W1,G,H,W
1730 MAT GET FL1,C$,A
1740 A$=CHR(D)||','||CHR(U)||','||CHR(H1)||','||CHR(W1)
1750 A$=A$||','||CHR(G)||','||CHR(H)||','||CHR(W)
1760 L0=LEN(A$)-1
1770 GOSUB 2310
1780 PRINT A$
1790 PRINT FL4,'151E';
1800 FOR L=1 TO 8
1810 A$=C$(L)
1820 L0=LEN(A$)-1
1830 PRINT FL4,'7D';
1840 GOSUB 2310
1850 PRINT A$
1860 PRINT FL4,'7D151E';
1870 NEXT L
1880 FOR L=1 TO 200
1890 A$=CHR(A(L,1))||','||CHR(A(L,2))||','||CHR(A(L,3))||','
1900 L0=LEN(A$)-1
1910 GOSUB 2310
1920 PRINT A$;
1930 A$=CHR(A(L,4))||','||CHR(A(L,5))||','||CHR(A(L,6))
1940 L0=LEN(A$)-1
1950 GOSUB 2310
1960 PRINT A$;
1970 A$=','||CHR(A(L,7))
1980 L0=LEN(A$)-1
1990 GOSUB 2310
2000 PRINT A$
2010 PRINT FL4,'151E';
2020 NEXT L
2030 REM *** EOF ***
2040 CLOSE FL1
2050 PRINT FL4,'041E1F'
2060 PRINT 'FILETRANSFER ENDED'
2070 GOTO 590
2080 REM *** MESSAGE ***
2090 GOSUB 2180
2100 PRINT A$
2110 WRITEFILE FLS,'A'
2120 PAUSE
2130 GOTO 590
2140 REM *** STOP ***
2150 CLOSE FL2
2160 CLOSE FL4
2170 STOP
2180 REM *** CONVERT FROM HEX TO EBCDIC ***
2190 WRITEFILE FLS,'F'
2200 A$=''
2210 FOR I=0 TO LEN(B$)-1 STEP 2
2220 J=IDX(H$,STR(B$,I+1,1))-1
2230 K=IDX(H$,STR(B$,I+2,1))-1
2240 IF J*16+K=0 GOTO 2270
2250 STR(A$,INT(I/2)+1,1)=STR(C$,J*16+K,1)
2260 GOTO 2280
2270 STR(A$,INT(I/2)+1,1)=X'FF'
2280 NEXT I
2290 WRITEFILE FLS,'N'
2300 RETURN
2310 REM *** CONVERT EBCDIC TO HEX ***
2320 WRITEFILE FLS,'F'
2330 FOR I=0 TO L0
2340 PRINT FL4,X$(IDX(C$,STR(A$,I+1,1))+1);
2350 NEXT I
2360 WRITEFILE FLS,'N'
2370 RETURN
2380 REM *** CONVERT EBC,ALC,HEX TO HEX ***
2390 WRITEFILE FLS,'F'
2400 IF T$(2)='EBC' GOTO 2430
2410 IF T$(2)='ALC' GOTO 2470
2420 IF T$(2)='HEX' GOTO 2500
2430 FOR I=0 TO L0
2440 PRINT FL4,X$(IDX(C$,STR(A$,I+1,1))+1);
2450 NEXT I
2460 GOTO 2500
2470 FOR I=0 TO L0
2480 PRINT FL4,X$(255-IDX(D$,STR(A$,I+1,1))+1);
2490 NEXT I
2500 WRITEFILE FLS,'N'
2510 RETURN
2520 REM *** DEBUG PART ***
2530 PAUSE
